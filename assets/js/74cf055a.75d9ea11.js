"use strict";(self.webpackChunk_graphql_mocks_docs=self.webpackChunk_graphql_mocks_docs||[]).push([[1472],{66941:function(e,t,a){a.r(t),a.d(t,{assets:function(){return s},contentTitle:function(){return d},default:function(){return m},frontMatter:function(){return o},metadata:function(){return p},toc:function(){return u}});var n=a(28427),i=a(84397),l=(a(2784),a(30876)),r=["components"],o={id:"validations",title:"Validations"},d=void 0,p={unversionedId:"paper/validations",id:"paper/validations",title:"Validations",description:"Validations are a powerful feature that keep the DocumentStore in check and maintain consistency after every transaction. They flexibly describe and define the set of rules to which the Document Store must conform to.",source:"@site/docs/paper/validations.md",sourceDirName:"paper",slug:"/paper/validations",permalink:"/docs/paper/validations",draft:!1,tags:[],version:"current",frontMatter:{id:"validations",title:"Validations"},sidebar:"docs",previous:{title:"Hooks",permalink:"/docs/paper/hooks"},next:{title:"Technical Notes",permalink:"/docs/paper/technical-notes"}},s={},u=[{value:"Provided and Default Validators",id:"provided-and-default-validators",level:2},{value:"<code>documentPropertyExistsAsFieldOnTypeValidator</code>",id:"documentpropertyexistsasfieldontypevalidator",level:3},{value:"<code>listFieldValidator</code>",id:"listfieldvalidator",level:3},{value:"<code>nonNullFieldValidator</code>",id:"nonnullfieldvalidator",level:3},{value:"<code>objectFieldValidator</code>",id:"objectfieldvalidator",level:3},{value:"<code>scalarFieldValidator</code>",id:"scalarfieldvalidator",level:3},{value:"<code>uniqueIdFieldValidator</code>",id:"uniqueidfieldvalidator",level:3},{value:"Removing a Default Validator",id:"removing-a-default-validator",level:3},{value:"Creating Custom Document Validators",id:"creating-custom-document-validators",level:2},{value:"Creating Custom Field Validators",id:"creating-custom-field-validators",level:2},{value:"Adding a Custom Validator Function to <code>Paper</code>",id:"adding-a-custom-validator-function-to-paper",level:2}],c={toc:u};function m(e){var t=e.components,a=(0,i.Z)(e,r);return(0,l.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Validations are a powerful feature that keep the ",(0,l.kt)("inlineCode",{parentName:"p"},"DocumentStore")," in check and maintain consistency after every transaction. They flexibly describe and define the set of rules to which the Document Store must conform to."),(0,l.kt)("p",null,"The default rules provided by the library enforce sensible defaults (see ",(0,l.kt)("em",{parentName:"p"},"Provided and Default Validators")," section) for GraphQL and connections between documents. If there are particular restrictions to your GraphQL API and its data then adding custom validators can be a great way to enforce these rules (see the ",(0,l.kt)("em",{parentName:"p"},"Creating Custom Validator")," sections)."),(0,l.kt)("p",null,"Validations are provided by ",(0,l.kt)("em",{parentName:"p"},"Validators")," which come in two flavors ",(0,l.kt)("em",{parentName:"p"},"Document Validators")," and ",(0,l.kt)("em",{parentName:"p"},"Field Validators"),". Which combination of validators are used can be specified, along with custom validators, too."),(0,l.kt)("p",null,"The validators are located on a ",(0,l.kt)("inlineCode",{parentName:"p"},"Paper")," instance under the ",(0,l.kt)("a",{parentName:"p",href:"pathname:///api/paper/classes/Paper.html#validators"},(0,l.kt)("inlineCode",{parentName:"a"},"validators")," property"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"paper.validators = {\n  document: [],\n  field: [],\n}\n")),(0,l.kt)("p",null,"where the ",(0,l.kt)("inlineCode",{parentName:"p"},"document")," property contains an array of Document Validators and the ",(0,l.kt)("inlineCode",{parentName:"p"},"field")," property contains an array of Field validators. See the next section for the defaults the are provided for each."),(0,l.kt)("h2",{id:"provided-and-default-validators"},"Provided and Default Validators"),(0,l.kt)("h3",{id:"documentpropertyexistsasfieldontypevalidator"},(0,l.kt)("a",{parentName:"h3",href:"pathname:///api/paper/modules/validators.html#documentPropertyExistsAsFieldOnTypeValidator"},(0,l.kt)("inlineCode",{parentName:"a"},"documentPropertyExistsAsFieldOnTypeValidator"))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Type: Document Validator"),(0,l.kt)("li",{parentName:"ul"},"Included by default")),(0,l.kt)("p",null,"Enforces that any property that exists on a document also exists on the GraphQL type"),(0,l.kt)("h3",{id:"listfieldvalidator"},(0,l.kt)("a",{parentName:"h3",href:"pathname:///api/paper/modules/validators.html#listFieldValidator"},(0,l.kt)("inlineCode",{parentName:"a"},"listFieldValidator"))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Type: Field Validator"),(0,l.kt)("li",{parentName:"ul"},"Included by default")),(0,l.kt)("p",null,"Enforces that lists are represented by arrays or connections to other documents"),(0,l.kt)("h3",{id:"nonnullfieldvalidator"},(0,l.kt)("a",{parentName:"h3",href:"pathname:///api/paper/modules/validators.html#nonNullFieldValidator"},(0,l.kt)("inlineCode",{parentName:"a"},"nonNullFieldValidator"))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Type: Field Validator"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"Note")," included by default")),(0,l.kt)("p",null,"Enforces that non-fields are not null. This is a stricter validator and is not included by default because there are cases where non-null fields may represent derived/computed data and may not be represented by data stored on the document."),(0,l.kt)("h3",{id:"objectfieldvalidator"},(0,l.kt)("a",{parentName:"h3",href:"pathname:///api/paper/modules/validators.html#objectFieldValidator"},(0,l.kt)("inlineCode",{parentName:"a"},"objectFieldValidator"))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Type: Field Validator"),(0,l.kt)("li",{parentName:"ul"},"Included by default")),(0,l.kt)("p",null,"Enforces that a field represented by an object is an object if it's not represented by connection(s)."),(0,l.kt)("h3",{id:"scalarfieldvalidator"},(0,l.kt)("a",{parentName:"h3",href:"pathname:///api/paper/modules/validators.html#scalarFieldValidator"},(0,l.kt)("inlineCode",{parentName:"a"},"scalarFieldValidator"))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Type: Field Validator"),(0,l.kt)("li",{parentName:"ul"},"Included by default")),(0,l.kt)("p",null,"Enforces that a field represented by a scalar is a scalar."),(0,l.kt)("h3",{id:"uniqueidfieldvalidator"},(0,l.kt)("a",{parentName:"h3",href:"pathname:///api/paper/modules/validators.html#uniqueIdFieldValidator"},(0,l.kt)("inlineCode",{parentName:"a"},"uniqueIdFieldValidator"))),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Type: Field"),(0,l.kt)("li",{parentName:"ul"},"Included by default")),(0,l.kt)("p",null,"Enforces that a type with ",(0,l.kt)("em",{parentName:"p"},"one")," ID field is unique amongst other documents of the same type."),(0,l.kt)("h3",{id:"removing-a-default-validator"},"Removing a Default Validator"),(0,l.kt)("p",null,"Validators are functions that exist on the ",(0,l.kt)("inlineCode",{parentName:"p"},"Paper")," instance under the ",(0,l.kt)("inlineCode",{parentName:"p"},"validators.document")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"validators.field")," arrays for Document Validators or Field Validators, respectively. To remove a validator from an instance set the array to a new array with the validators excluded."),(0,l.kt)("p",null,"In this example ",(0,l.kt)("inlineCode",{parentName:"p"},"uniqueIdFieldValidator")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"documentPropertyExistsAsFieldOnTypeValidator")," are filtered out from being used by the instance of ",(0,l.kt)("inlineCode",{parentName:"p"},"Paper"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import {\n  uniqueIdFieldValidator,\n  documentPropertyExistsAsFieldOnTypeValidator\n} from 'graphql-paper/validations';\n\nconst excludedValidators = [\n  uniqueIdFieldValidator,\n  documentPropertyExistsAsFieldOnTypeValidator\n];\n\npaper.validators.document = paper.validators.document.filter(\n  validator => !excludedValidators.includes(validator)\n);\n\npaper.validators.field = paper.validators.field.filter(\n  validator => !excludedValidators.includes(validator)\n);\n")),(0,l.kt)("h2",{id:"creating-custom-document-validators"},"Creating Custom Document Validators"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"api/paper/interfaces/types.DocumentTypeValidator.html"},"Interface API"))),(0,l.kt)("p",null,"A Document Validator enforces validation at the document-level, for the field-level use a Field Validator (see below). Document Validators implement the ",(0,l.kt)("inlineCode",{parentName:"p"},"DocumentTypeValidator")," interface with an object that has ",(0,l.kt)("inlineCode",{parentName:"p"},"validate")," function/method. If anything is found on the ",(0,l.kt)("inlineCode",{parentName:"p"},"Document")," that is invalid the the ",(0,l.kt)("inlineCode",{parentName:"p"},"validate")," method should thrown an ",(0,l.kt)("inlineCode",{parentName:"p"},"Error")," or a class that extends ",(0,l.kt)("inlineCode",{parentName:"p"},"Error"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"{\n  function validate({\n    type: GraphQLObjectType<any>,\n    document: Document,\n    graphqlSchema: GraphQLSchema,\n    store: DocumentStore\n  })\n}\n")),(0,l.kt)("p",null,"Available within ",(0,l.kt)("inlineCode",{parentName:"p"},"validate"),":"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"document")," represents the document being validated"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"type")," represents the ",(0,l.kt)("inlineCode",{parentName:"li"},"GraphQLType")," of the document being validated"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"graphqlSchema")," is an instance of the ",(0,l.kt)("inlineCode",{parentName:"li"},"GraphQLSchema")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"store")," is read-only version of the ",(0,l.kt)("inlineCode",{parentName:"li"},"DocumentStore"))),(0,l.kt)("h2",{id:"creating-custom-field-validators"},"Creating Custom Field Validators"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"/api/paper/interfaces/types.FieldValidator.html"},"Interface API"))),(0,l.kt)("p",null,"Field Validators that implement the ",(0,l.kt)("inlineCode",{parentName:"p"},"FieldValidator")," interface with an object that has ",(0,l.kt)("inlineCode",{parentName:"p"},"validate")," function/method and the ",(0,l.kt)("inlineCode",{parentName:"p"},"skipConnectionValue"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"skipNullValue")," properties. If anything is found on the ",(0,l.kt)("inlineCode",{parentName:"p"},"Document")," that is invalid the the ",(0,l.kt)("inlineCode",{parentName:"p"},"validate")," method should thrown an ",(0,l.kt)("inlineCode",{parentName:"p"},"Error")," or a class that extends ",(0,l.kt)("inlineCode",{parentName:"p"},"Error"),". See the section below on ",(0,l.kt)("em",{parentName:"p"},"Adding a Custom Validator Function"),". See the section below on ",(0,l.kt)("em",{parentName:"p"},"Adding a Custom Validator Function"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"{\n  skipConnectionValue: boolean;\n  skipNullValue: boolean;\n\n  function validate({\n    graphqlSchema: GraphQLSchema,\n    type: GraphQLObjectType,\n    field: GraphQLField,\n    document: Document,\n    fieldName: string,\n    fieldValue: any,\n    fieldConnections: DocumentKey[] | undefined,\n    store: DocumentStore\n  })\n}\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"skipConnectionValue")," skips validation when the field is represented by a connected value on the document"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"skipNullValue")," skips validation when the field is represented by a null or undefined value on the document")),(0,l.kt)("p",null,"Available within ",(0,l.kt)("inlineCode",{parentName:"p"},"validate"),":"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"document")," represents the document being validated"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"type")," represents the ",(0,l.kt)("inlineCode",{parentName:"li"},"GraphQLType")," of the document being validated"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"field")," represents the ",(0,l.kt)("inlineCode",{parentName:"li"},"GraphQLField")," of the document property being validated"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"fieldName")," represents a string for the property on the document (and the field on the GraphQL type)"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"graphqlSchema")," is an instance of the ",(0,l.kt)("inlineCode",{parentName:"li"},"GraphQLSchema")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"fieldValue")," represents the value of the field (keep in mind that the field might be have connections to other documents under ",(0,l.kt)("inlineCode",{parentName:"li"},"fieldConnections")," in which case those would be the representative value when the property is accessed)"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"store")," is read-only version of the ",(0,l.kt)("inlineCode",{parentName:"li"},"DocumentStore")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"fieldConnections")," is an array of document keys or ",(0,l.kt)("inlineCode",{parentName:"li"},"undefined")," if none exist (in which case ",(0,l.kt)("inlineCode",{parentName:"li"},"fieldValue")," is the representative value when the property is accessed)")),(0,l.kt)("h2",{id:"adding-a-custom-validator-function-to-paper"},"Adding a Custom Validator Function to ",(0,l.kt)("inlineCode",{parentName:"h2"},"Paper")),(0,l.kt)("p",null,"To add a custom validator function to an instance of ",(0,l.kt)("inlineCode",{parentName:"p"},"Paper")," import the function and push it on to the corresponding ",(0,l.kt)("inlineCode",{parentName:"p"},"document")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"field")," array depending on if it's a Document Validator or Field Validator, respectively."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import { customFieldValidator, customDocumentValidator } from './custom-validators';\n\npaper.validators.field.push(customFieldValidator);\npaper.validators.document.push(customDocumentValidator);\n")))}m.isMDXComponent=!0},30876:function(e,t,a){a.d(t,{Zo:function(){return s},kt:function(){return m}});var n=a(2784);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var d=n.createContext({}),p=function(e){var t=n.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},s=function(e){var t=p(e.components);return n.createElement(d.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,l=e.originalType,d=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),c=p(a),m=i,h=c["".concat(d,".").concat(m)]||c[m]||u[m]||l;return a?n.createElement(h,r(r({ref:t},s),{},{components:a})):n.createElement(h,r({ref:t},s))}));function m(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=a.length,r=new Array(l);r[0]=c;var o={};for(var d in t)hasOwnProperty.call(t,d)&&(o[d]=t[d]);o.originalType=e,o.mdxType="string"==typeof e?e:i,r[1]=o;for(var p=2;p<l;p++)r[p]=a[p];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"}}]);