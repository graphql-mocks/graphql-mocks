"use strict";(self.webpackChunk_graphql_mocks_docs=self.webpackChunk_graphql_mocks_docs||[]).push([[9609],{5141:function(e,n,t){t.d(n,{u:function(){return r}});var a=t(2784);function r(e){return a.createElement(a.Fragment,null,a.createElement("strong",null,"Result: "),a.createElement("pre",{className:"graphql-result"},JSON.stringify(e.result,null,2)))}},59332:function(e,n,t){t.r(n),t.d(n,{assets:function(){return w},contentTitle:function(){return N},default:function(){return P},frontMatter:function(){return k},metadata:function(){return v},toc:function(){return b}});var a=t(28427),r=t(84397),o=(t(2784),t(30876)),i=["components"],l={toc:[]};function s(e){var n=e.components,t=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import { embed } from "graphql-mocks";\nimport { relayWrapper } from "graphql-mocks/relay";\n\nconst relayMiddleware = embed({\n  wrappers: [\n    relayWrapper({\n      cursorForNode: (node) => node.id,\n      force: false,\n    }),\n  ],\n});\n')))}s.isMDXComponent=!0;var p=["components"],u={toc:[]};function d(e){var n=e.components,t=(0,r.Z)(e,p);return(0,o.kt)("wrapper",(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import { GraphQLHandler } from "graphql-mocks";\nimport { graphqlSchema } from "./graphql-schema";\n\nconst handler = new GraphQLHandler({\n  resolverMap: {\n    Query: {\n      actors() {\n        return [\n          { id: "1", name: "Suzy Bishop" },\n          { id: "2", name: "Eli Cash" },\n          { id: "3", name: "Margot Tenenbaum" },\n        ];\n      },\n    },\n  },\n\n  middlewares: [relayMiddleware],\n  dependencies: { graphqlSchema },\n});\n')))}d.isMDXComponent=!0;var c=["components"],m={toc:[]};function g(e){var n=e.components,t=(0,r.Z)(e,c);return(0,o.kt)("wrapper",(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const query = handler.query(`\n  {\n    actors(first: 2) {\n      edges {\n        node {\n          id\n          name\n        }\n      }\n      pageInfo {\n        hasNextPage\n        hasPreviousPage\n        startCursor\n        endCursor\n      }\n    }\n  }\n`);\nquery.then((result) => console.log(result));\n")))}g.isMDXComponent=!0;var f=t(5141),h={data:{actors:{edges:[{node:{id:"1",name:"Suzy Bishop"}},{node:{id:"2",name:"Eli Cash"}}],pageInfo:{endCursor:"2",hasNextPage:!0,hasPreviousPage:!1,startCursor:"1"}}}},y=["components"],k={title:"Relay Pagination"},N=void 0,v={unversionedId:"guides/relay-pagination",id:"guides/relay-pagination",title:"Relay Pagination",description:'One of the common ways of paginating in GraphQL is by using "Relay Pagnation". Relay Pagination is cursor-based and was',source:"@site/docs/guides/relay-pagination.mdx",sourceDirName:"guides",slug:"/guides/relay-pagination",permalink:"/docs/guides/relay-pagination",draft:!1,tags:[],version:"current",frontMatter:{title:"Relay Pagination"},sidebar:"docs",previous:{title:"Automatic Resolver Filtering with Wrappers",permalink:"/docs/guides/automatic-filtering"},next:{title:"Automatic Mocking with Fake Data using Falso",permalink:"/docs/guides/fake-data"}},w={},b=[{value:"Relay Resolver Wrapper",id:"relay-resolver-wrapper",level:2},{value:"Example",id:"example",level:3},{value:"Relay Utility functions",id:"relay-utility-functions",level:2},{value:"<code>paginateNodes</code>",id:"paginatenodes",level:3},{value:"<code>isRelayConnectionField</code>",id:"isrelayconnectionfield",level:3}],C={toc:b};function P(e){var n=e.components,t=(0,r.Z)(e,y);return(0,o.kt)("wrapper",(0,a.Z)({},C,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,'One of the common ways of paginating in GraphQL is by using "Relay Pagnation". Relay Pagination is cursor-based and was\nmade specifically with GraphQL in mind and is defined by the\n',(0,o.kt)("a",{parentName:"p",href:"https://relay.dev/graphql/connections.htm"},"Relay Pagination Specification"),"."),(0,o.kt)("p",null,"To make using relay pagination as possible graphql-mocks provides a Relay Wrapper and also exposes the underlying\nutility functions in case you want to paginate something yourself."),(0,o.kt)("h2",{id:"relay-resolver-wrapper"},"Relay Resolver Wrapper"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"See the ",(0,o.kt)("a",{parentName:"li",href:"pathname:///api/graphql-mocks/modules/relay.html#relayWrapper"},"API reference"))),(0,o.kt)("p",null,"The Relay Resolver Wrapper can paginate the results of the resolver it's wrapping, automatically. It assumes that what\nis returned from the wrapped resolver is the full result set and then it applies the pagination args, ",(0,o.kt)("inlineCode",{parentName:"p"},"first"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"last"),",\n",(0,o.kt)("inlineCode",{parentName:"p"},"before"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"after"),", to return the current results."),(0,o.kt)("p",null,"When applied, the wrapper by default will paginate for any ",(0,o.kt)("inlineCode",{parentName:"p"},"Connection")," fields that:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"have pagination args (first, last, before, after)"),(0,o.kt)("li",{parentName:"ul"},"return an object type that has an ",(0,o.kt)("inlineCode",{parentName:"li"},"edges")," field")),(0,o.kt)("p",null,"If it does not meet these conditions the wrapper returns the original result without paginating, unless the ",(0,o.kt)("inlineCode",{parentName:"p"},"force"),"\noption is passed."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import { relayWrapper } from 'graphql-mocks/relay';\n\nrelayWrapper({\n  // required, must specify a function that can return\n  // a cursor for a given node\n  cursorForNode: (node) => node.id\n\n  // defaults to false\n  force: false\n})\n")),(0,o.kt)("p",null,"The wrapper would take a single object or an array of object and return relay pagination for the connection field with\nthe paginated objects as the ",(0,o.kt)("inlineCode",{parentName:"p"},"node")," for each edge."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"{\n  edges: [\n    {\n      node\n      cursor\n    }\n  ],\n  pageInfo: {\n    hasNextPage,\n    hasPreviousPage,\n    startCursor,\n    endCursor\n  }\n}\n")),(0,o.kt)("h3",{id:"example"},"Example"),(0,o.kt)("p",null,"This example uses an array of ",(0,o.kt)("inlineCode",{parentName:"p"},"Actor")," objects:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"[\n  { id: '1', name: 'Suzy Bishop' },\n  { id: '2', name: 'Eli Cash' },\n  { id: '3', name: 'Margot Tenenbaum' },\n];\n")),(0,o.kt)("p",null,"This array will be paginated as an ",(0,o.kt)("inlineCode",{parentName:"p"},"ActorConnection"),", using any pagination args, on the ",(0,o.kt)("inlineCode",{parentName:"p"},"Query.actors")," field."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"type Query {\n  actors(first: Int, last: Int, before: String, after: String): ActorConnection!\n}\n\ntype ActorConnection {\n  edges: [ActorEdge!]!\n  pageInfo: PageInfo!\n}\n\ntype ActorEdge {\n  node: Actor!\n  cursor: String!\n}\n\ntype Actor {\n  id: ID!\n  name: String!\n}\n\ntype PageInfo {\n  hasNextPage: Boolean!\n  hasPreviousPage: Boolean!\n  startCursor: String\n  endCursor: String\n}\n")),(0,o.kt)("p",null,"Using ",(0,o.kt)("inlineCode",{parentName:"p"},"embed")," with the wrapper creates a Resolver Map Middleware that can be applied against all resolvers."),(0,o.kt)(s,{mdxType:"RelayWrapperEmbed"}),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"cursorForNode")," argument is required, representing a function that receives the node and must return an opaque\ncursor for pagination. In the example the ",(0,o.kt)("inlineCode",{parentName:"li"},"id")," field on the node is returned for the cursor."),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"relayWrapper")," will default with a ",(0,o.kt)("inlineCode",{parentName:"li"},"force")," value of false.")),(0,o.kt)("p",null,"Now, let's use the manufactured ",(0,o.kt)("inlineCode",{parentName:"p"},"relayMiddleware")," middleware with our ",(0,o.kt)("inlineCode",{parentName:"p"},"GraphQLHandler"),". Remember that this middleware\nmust come ",(0,o.kt)("em",{parentName:"p"},"after")," any other middlewares that would return the data being paginated."),(0,o.kt)(d,{mdxType:"RelayWrapperHandler"}),(0,o.kt)("p",null,"The data being paginated could be from a previous middleware in the ",(0,o.kt)("inlineCode",{parentName:"p"},"middlewares")," array but in this example the initial\n",(0,o.kt)("inlineCode",{parentName:"p"},"resolverMap")," provides the two characters that will be relay paginated based on the pagination args on the\n",(0,o.kt)("inlineCode",{parentName:"p"},"Query.actors")," fields."),(0,o.kt)("p",null,"Let's run a query against the handler selecting the first two actors:"),(0,o.kt)(g,{mdxType:"RelayWrapperQuery"}),(0,o.kt)(f.u,{result:h,mdxType:"GraphQLResult"}),(0,o.kt)("p",null,"Notice that ",(0,o.kt)("inlineCode",{parentName:"p"},"hasPreviousPage")," is ",(0,o.kt)("inlineCode",{parentName:"p"},"true")," since we only requested the first two actors. Also, that the cursors are using the object's id based on the ",(0,o.kt)("inlineCode",{parentName:"p"},"cursorForNode")," function specified."),(0,o.kt)("h2",{id:"relay-utility-functions"},"Relay Utility functions"),(0,o.kt)("p",null,"When relay pagination is needed and the Relay Wrapper isn't appropriate, the underlying utility functions can help."),(0,o.kt)("h3",{id:"paginatenodes"},(0,o.kt)("inlineCode",{parentName:"h3"},"paginateNodes")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"pathname:///api/graphql-mocks/modules/relay.html#paginateNodes"},"API"))),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"paginateNodes")," takes in an array of nodes and returns a paginated result for a connection field."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"paginateNodes(\n  // collection of nodes, or objects, to paginate\n  nodes,\n\n  // from the resolver function\n  args: { first, last, before, after },\n\n  // a function that returns a cursor for a given node\n  cursorForNode,\n)\n")),(0,o.kt)("p",null,"Returning the following structure"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"{\n  edges: [\n    {\n      node\n      cursor\n    }\n  ],\n  pageInfo: {\n    hasNextPage,\n    hasPreviousPage,\n    startCursor,\n    endCursor\n  }\n}\n")),(0,o.kt)("h3",{id:"isrelayconnectionfield"},(0,o.kt)("inlineCode",{parentName:"h3"},"isRelayConnectionField")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"pathname:///api/graphql-mocks/modules/relay.html#isRelayConnectionField"},"API"))),(0,o.kt)("p",null,"Useful for determining if a ",(0,o.kt)("inlineCode",{parentName:"p"},"GraphQLField")," is a relay connection field."))}P.isMDXComponent=!0},30876:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return m}});var a=t(2784);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(t),m=r,g=c["".concat(s,".").concat(m)]||c[m]||d[m]||o;return t?a.createElement(g,i(i({ref:n},u),{},{components:t})):a.createElement(g,i({ref:n},u))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=c;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"}}]);